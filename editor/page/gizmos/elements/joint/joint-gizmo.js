const o=require("chroma-js"),e=require("../tools"),t=Editor.require("scene://utils/node");let r={anchor:0,connectedAnchor:1};class c extends Editor.Gizmo{visible(){return!0}rectHitTest(o,e){let r=this._root.tbox(),c=t.getWorldPosition(this.node);return!!e&&o.containsRect(cc.rect(c.x-r.width/2,c.y-r.height/2,r.width,r.height))}onCreateMoveCallbacks(){let o,e;return{start:(t,r)=>{o=t,e=r},update:(t,c,n,i)=>{let s=o+t,h=e+c;if(i===r.anchor){let o=this.node.convertToNodeSpace(cc.v2(s,h));this.adjustValue(o),this.target.anchor=o}else if(i===r.connectedAnchor){let o=this.target.connectedBody.node.convertToNodeSpace(cc.v2(s,h));this.adjustValue(o),this.target.connectedAnchor=o}}}}onCreateRoot(){let t=this._root,n=n=>{let i;n===c.ToolType.anchor?i="#4793e2":n===c.ToolType.connectedAnchor&&(i="#cccc00");let s=t.line(0,0,1,1).stroke({width:2,color:i}),h=this.createAnchorGroup();h.style("pointer-events","bounding-box").style("cursor","move").stroke({width:2,color:i}).fill({color:i}),h.on("mouseover",function(){var e=o(i).brighter().hex();h.stroke({color:e}),s.stroke({color:e})}),h.on("mouseout",function(){h.stroke({color:i}),s.stroke({color:i})});let d=h.plot;return h.plot=(o=>{let t,c,i,l;if(d&&d.apply(h,arguments),n===r.anchor)t=o.pos.x,c=o.pos.y,i=o.anchor.x,l=o.anchor.y;else{if(!o.connectedPos)return;t=o.connectedPos.x,c=o.connectedPos.y,i=o.connectedAnchor.x,l=o.connectedAnchor.y}h.move(i,l),this.editing||this.hovering?(s.plot(t,c,i,l),s.style("stroke-dasharray",e.dashLength()),s.show()):s.hide()}),this.registerMoveSvg(h,n),h};t.anchorGroup=n(r.anchor),t.connectedAnchorGroup=n(r.connectedAnchor),this.createToolGroup&&(t.toolGroup=this.createToolGroup())}createArgs(){let o={},e=this.node,t=e.convertToWorldSpaceAR(this.target.anchor);if(o.anchor=this.worldToPixel(t),o.pos=this.worldToPixel(e.convertToWorldSpaceAR(cc.Vec2.ZERO)),this.target.connectedBody){let e=this.target.connectedBody.node,t=e.convertToWorldSpaceAR(this.target.connectedAnchor);o.connectedAnchor=this.worldToPixel(t),o.connectedPos=this.worldToPixel(e.convertToWorldSpaceAR(cc.Vec2.ZERO))}return o}dirty(){let o=this._viewDirty()||this._nodeDirty()||this._dirty;return this.target.connectedBody&&(o=o||this._nodeDirty(this.target.connectedBody.node)),o}onUpdate(){let o=this._root,e=this.createArgs();this.target.connectedBody?o.connectedAnchorGroup.show():o.connectedAnchorGroup.hide(),o.anchorGroup.plot(e),o.connectedAnchorGroup.plot(e),o.toolGroup&&o.toolGroup.plot(e)}}c.ToolType=r,module.exports=c;