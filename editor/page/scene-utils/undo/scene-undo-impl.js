"use strict";var e=["_parent","_children","parent","children","rotationX","rotationY","rotation"],t=cc.Class.Attr.DELIMETER+"hasGetter",r=cc.Class.Attr.DELIMETER+"hasSetter",n=cc.Class.Attr.DELIMETER+"serializable";function o(e){return e instanceof cc.ValueType?e.clone():e}function c(e,t,r,n){r=r||o;let c={};if(n)for(let o=0;o<t.length;o++){let s=t[o];n(s)&&(c[s]=r(e[s]))}else for(let n=0;n<t.length;n++){let o=t[n];c[o]=r(e[o])}return c}function s(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(o):e.constructor===Object?c(e,Object.getOwnPropertyNames(e)):o(e):e}function a(o){if(!o||"object"!=typeof o)return Editor.error("Unknown object to record"),void 0;if(Array.isArray(o))return o.map(s);var a=o.constructor;if(a===Object)return c(o,Object.getOwnPropertyNames(o),s);if(cc.Class._isCCClass(a)){var i=a.__props__,f=cc.Class.Attr.getClassAttrs(a),u=c(o,i,s,function(c){var s=f[c+t];return!(!s&&!1===f[c+n])&&(s===f[c+r]&&((!o.hasOwnProperty(c)||"function"!==o[c])&&(!cc.Node.isNode(o)||!e.includes(c))))});return o.__asyncStates&&(u.__asyncStates=JSON.parse(JSON.stringify(o.__asyncStates))),u}Editor.error("Unknown object to record")}function i(e,t){return t&&e&&"object"==typeof t?t.constructor!==e.constructor?t:Array.isArray(t)?(f(e,t),e):e.constructor===Object?(u(e,t),e):o(t):t}function f(e,t,r){var n,c=e.length=t.length;if(r)for(n=0;n<c;n++)e[n]=r(e[n],t[n]);else for(n=0;n<c;n++)e[n]=o(t[n])}function u(e,t,r){var n;for(n in e)n in t||delete e[n];if(r)for(n in t)e[n]=r(e[n],t[n]);else for(n in t)e[n]=o(t[n])}function l(e,t){var r,n,o;e instanceof cc.Object&&(cc.Object._willDestroy(e)&&(!cc.isValid(t)||cc.Object._willDestroy(t)||cc.Object._cancelDestroy(e)));var c="function"==typeof e.onRestore;if(!c)for(o in t)if((r=cc.js.getPropertyDescriptor(e,o))&&r.set){n=i(e[o],t[o]);var s=e[o];if(n!==s){if(n instanceof cc.ValueType){if(n.equals(s))continue}else if(s instanceof cc.ValueType&&s.equals(n))continue;e[o]=n}}for(o in t){if((r=Object.getOwnPropertyDescriptor(e,o))&&"value"in r)r.writable&&(e[o]=i(e[o],t[o]))}(function(e,t){var r=t.__asyncStates;if(r)for(var n in r){var o=r[n];"start"===o.state&&Editor.setAsset(e,n,o.uuid)}})(e,t),c&&e.onRestore()}function d(e,t){if(!e||"object"!=typeof e)return Editor.error("Unknown object to restore");if(!t)return Editor.error("Invalid record to restore");if(Array.isArray(e))f(e,t,i);else{var r=e.constructor;r===Object?u(e,t,i):cc.Class._isCCClass(r)?l(e,t):Editor.error("Unknown object to restore")}}function p(e){e._objFlags&=cc.Object.Flags.PersistentMask,e._objFlags&=~cc.Object.Flags.Destroyed,e instanceof cc.Component&&(cc.engine.attachedObjsForEditor[e.uuid]=e)}module.exports={recordObject:a,restoreObject:d,renewObject:p,recordNode:function(e){for(var t={},r=0;r<e._components.length;++r){var n=e._components[r];t[n.uuid]=a(n)}return{node:a(e),comps:t}},restoreNode:function(e,t){for(var r in t.comps){var n=cc.engine.getInstanceById(r);n&&d(n,t.comps[r])}d(e,t.node)},recordDeleteNode:function(e){var t=[];_Scene.walk(e,!1,function(e){t.push({node:e,data:function(e){for(var t=[],r=0;r<e._components.length;++r){var n=e._components[r];t.push({comp:n,data:a(n)})}return{nodeData:a(e),compInfos:t}}(e)})});for(var r=[],n=0;n<e._components.length;++n){var o=e._components[n];r.push({comp:o,data:a(o)})}return{parent:e.parent,siblingIndex:e.getSiblingIndex(),nodeData:a(e),compInfos:r,childInfos:t}},restoreDeleteNode:function(e,t){t.compInfos.forEach(function(e){d(e.comp,e.data),p(e.comp)}),t.childInfos.forEach(function(e){(function(e,t){d(e,t.nodeData),p(e),t.compInfos.forEach(function(e){d(e.comp,e.data),p(e.comp)})})(e.node,e.data)}),d(e,t.nodeData),p(e),e.parent=t.parent,e.setSiblingIndex(t.siblingIndex),Editor.Ipc.sendToAll("scene:create-nodes-in-scene")}};