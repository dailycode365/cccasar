"use strict";var e=require("electron"),n=require("fire-path"),s=e.ipcRenderer,o=Editor.require("unpack://engine-dev/cocos2d/core/platform/callbacks-invoker"),t=cc.AssetLibrary;function c(e){cc.loader.release(e)}s.on("asset-db:assets-moved",function(e,n){n.forEach(function(e){t.onAssetMoved(e.uuid,e.srcPath,e.destPath)})}),s.on("asset-db:asset-changed",function(e,n){t.onAssetChanged(n.uuid)}),s.on("asset-db:assets-deleted",function(e,n){n.forEach(function(e){t.onAssetRemoved(e.uuid,e.path)})});var a=t.assetListener=new o;t.onAssetMoved=function(e,s,o){var c=n.basenameNoExt(s),r=n.basenameNoExt(o);cc.loader.refreshUrl(e,s,o),a.hasEventListener(e)&&t._queryAssetInfoInEditor(e,function(n,s,t){n||t&&a.invoke(e,o)}),"undefined"!=typeof _Scene&&_Scene.walk(cc.director.getScene(),!1,n=>{var s=n._prefab;if(s){if(s.asset&&s.asset._uuid===e)n.name!==c||(n.name=r);return!0}})},t.onAssetChanged=function(e){t._queryAssetInfoInEditor(e,function(n,s,o,r){if(!n){if(cc.loader.getRes(s))return cc.loader.release(s),cc.loader.load(s,function(n,o){o&&a.hasEventListener(e)&&a.invoke(e,s)}),void 0;a.hasEventListener(e)&&(c(s),cc.js.isChildClassOf(r,cc.Scene)||(o?a.invoke(e,s):t.loadAsset(e,function(n,s){a.invoke(e,s)})))}})},t.onAssetRemoved=function(e,n){c(n),console.log("delete cache of "+n),a.invoke(e,null)};