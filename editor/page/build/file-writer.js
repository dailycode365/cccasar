"use strict";var e=require("path");const{promisify:t}=require("util");var r=require("fire-fs"),i=require("del"),s=require("globby");module.exports=class{constructor(e,t){this.dest=e,this.jsonSpace=t?2:0}getUuidPathNoExt(t){return e.join(this.dest,t.slice(0,2),t)}getJsonPath(e){return this.getUuidPathNoExt(e)+".json"}write(e,t,i){r.outputFile(e,t,i)}writeJsonByUuidNoCache(e,i,s){if(!s)return t(r.outputFile)(this.getJsonPath(e),i);r.outputFile(this.getJsonPath(e),i,s)}writeJsonByUuid(e,t,r){var i=JSON.stringify(t,null,this.jsonSpace);return this.writeJsonByUuidNoCache(e,i,r)}read(e,t){r.readFile(e,t)}readJsonByUuid(e,t){var i=this.getJsonPath(e);r.readFile(i,function(e,r){if(e)return t(e);var s;try{s=JSON.parse(r)}catch(e){return e.message=i+": "+e.message,t(e)}t(null,s)})}delete(e,t){i(e,{force:!0},t)}deleteJsonsByUuid(e,t){var r=e.map(this.getJsonPath.bind(this));this.delete(r,t)}flush(t){var i=e.join(this.dest,"??/");s(i,(e,i)=>{if(e)return t(e);try{for(var s=0;s<i.length;s++){var n=i[s];0===r.readdirSync(n).length&&r.rmdirSync(n)}}catch(e){return t(e)}t()})}};