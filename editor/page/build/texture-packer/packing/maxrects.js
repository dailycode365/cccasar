function t(t,e,i,h){this.x=t||0,this.y=e||0,this.width=i||0,this.height=h||0}t.prototype={constructor:t,clone:function(){return new t(this.x,this.y,this.width,this.height)}},t.isContainedIn=function(t,e){return t.x>=e.x&&t.y>=e.y&&t.x+t.width<=e.x+e.width&&t.y+t.height<=e.y+e.height};function e(t,e,i){this.binWidth=0,this.binHeight=0,this.allowRotate=!1,this.usedRectangles=[],this.freeRectangles=[],this.init(t,e,i)}e.prototype={constructor:e,init:function(e,i,h){this.binWidth=e,this.binHeight=i,this.allowRotate=h||!1,this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(new t(0,0,e,i))},insertRect:function(e,i,h){var a=new t,n={value:0},o={value:0};switch(h=h||0){case 0:a=this._findPositionForNewNodeBestShortSideFit(e,i,n,o);break;case 3:a=this._findPositionForNewNodeBottomLeft(e,i,n,o);break;case 4:a=this._findPositionForNewNodeContactPoint(e,i,n);break;case 1:a=this._findPositionForNewNodeBestLongSideFit(e,i,o,n);break;case 2:a=this._findPositionForNewNodeBestAreaFit(e,i,n,o)}return 0===a.height?a:(this._placeRectangle(a),a)},insertRects:function(e,i){for(var h=[];e.length>0;){for(var a=1/0,n=1/0,o=-1,s=new t,r=0;r<e.length;r++){var l={value:0},u={value:0},d=this._scoreRectangle(e[r].width,e[r].height,i,l,u);(l.value<a||l.value===a&&u.value<n)&&(a=l.value,n=u.value,s=d,o=r)}if(-1===o)return h;this._placeRectangle(s);var g=e.splice(o,1)[0];g.x=s.x,g.y=s.y,g.width!==g.height&&g.width===s.height&&g.height===s.width&&(g.rotated=!g.rotated),h.push(g)}return h},_placeRectangle:function(t){for(var e=this.freeRectangles.length,i=0;i<e;i++)this._splitFreeNode(this.freeRectangles[i],t)&&(this.freeRectangles.splice(i,1),i--,e--);this._pruneFreeList(),this.usedRectangles.push(t)},_scoreRectangle:function(e,i,h,a,n){var o=new t;switch(a.value=1/0,n.value=1/0,h){case 0:o=this._findPositionForNewNodeBestShortSideFit(e,i,a,n);break;case 3:o=this._findPositionForNewNodeBottomLeft(e,i,a,n);break;case 4:o=this._findPositionForNewNodeContactPoint(e,i,a),a=-a;break;case 1:o=this._findPositionForNewNodeBestLongSideFit(e,i,n,a);break;case 2:o=this._findPositionForNewNodeBestAreaFit(e,i,a,n)}return 0===o.height&&(a.value=1/0,n.value=1/0),o},_occupancy:function(){for(var t=this.usedRectangles,e=0,i=0;i<t.length;i++)e+=t[i].width*t[i].height;return e/(this.binWidth*this.binHeight)},_findPositionForNewNodeBottomLeft:function(e,i,h,a){var n,o,s=this.freeRectangles,r=new t;h.value=1/0;for(var l=0;l<s.length;l++)(n=s[l]).width>=e&&n.height>=i&&((o=n.y+i)<h.value||o===h.value&&n.x<a.value)&&(r.x=n.x,r.y=n.y,r.width=e,r.height=i,h.value=o,a.value=n.x),this.allowRotate&&n.width>=i&&n.height>=e&&((o=n.y+e)<h.value||o===h.value&&n.x<a.value)&&(r.x=n.x,r.y=n.y,r.width=i,r.height=e,h.value=o,a.value=n.x);return r},_findPositionForNewNodeBestShortSideFit:function(e,i,h,a){var n,o,s,r,l,u=this.freeRectangles,d=new t;h.value=1/0;for(var g=0;g<u.length;g++){var c,v,w,f;(n=u[g]).width>=e&&n.height>=i&&(o=Math.abs(n.width-e),s=Math.abs(n.height-i),r=Math.min(o,s),l=Math.max(o,s),(r<h.value||r===h.value&&l<a.value)&&(d.x=n.x,d.y=n.y,d.width=e,d.height=i,h.value=r,a.value=l)),this.allowRotate&&n.width>=i&&n.height>=e&&(c=Math.abs(n.width-i),v=Math.abs(n.height-e),w=Math.min(c,v),f=Math.max(c,v),(w<h.value||w===h.value&&f<a.value)&&(d.x=n.x,d.y=n.y,d.width=i,d.height=e,h.value=w,a.value=f))}return d},_findPositionForNewNodeBestLongSideFit:function(e,i,h,a){var n,o,s,r,l,u=this.freeRectangles,d=new t;a.value=1/0;for(var g=0;g<u.length;g++)(n=u[g]).width>=e&&n.height>=i&&(o=Math.abs(n.width-e),s=Math.abs(n.height-i),r=Math.min(o,s),((l=Math.max(o,s))<a.value||l===a.value&&r<h.value)&&(d.x=n.x,d.y=n.y,d.width=e,d.height=i,h.value=r,a.value=l)),this.allowRotate&&n.width>=i&&n.height>=e&&(o=Math.abs(n.width-i),s=Math.abs(n.height-e),r=Math.min(o,s),((l=Math.max(o,s))<a.value||l===a.value&&r<h.value)&&(d.x=n.x,d.y=n.y,d.width=i,d.height=e,h.value=r,a.value=l));return d},_findPositionForNewNodeBestAreaFit:function(e,i,h,a){var n,o,s,r,l,u=this.freeRectangles,d=new t;h.value=1/0;for(var g=0;g<u.length;g++)l=(n=u[g]).width*n.height-e*i,n.width>=e&&n.height>=i&&(o=Math.abs(n.width-e),s=Math.abs(n.height-i),r=Math.min(o,s),(l<h.value||l===h.value&&r<a.value)&&(d.x=n.x,d.y=n.y,d.width=e,d.height=i,a.value=r,h.value=l)),this.allowRotate&&n.width>=i&&n.height>=e&&(o=Math.abs(n.width-i),s=Math.abs(n.height-e),r=Math.min(o,s),(l<h.value||l===h.value&&r<a.value)&&(d.x=n.x,d.y=n.y,d.width=i,d.height=e,a.value=r,h.value=l));return d},_commonIntervalLength:function(t,e,i,h){return e<i||h<t?0:Math.min(e,h)-Math.max(t,i)},_contactPointScoreNode:function(t,e,i,h){var a,n=this.usedRectangles,o=0;0!==t&&t+i!==this.binWidth||(o+=h),0!==e&&e+h!==this.binHeight||(o+=i);for(var s=0;s<n.length;s++)(a=n[s]).x!==t+i&&a.x+a.width!==t||(o+=this._commonIntervalLength(a.y,a.y+a.height,e,e+h)),a.y!==e+h&&a.y+a.height!==e||(o+=this._commonIntervalLength(a.x,a.x+a.width,t,t+i));return o},_findPositionForNewNodeContactPoint:function(e,i,h){var a,n,o=this.freeRectangles,s=new t;h.value=-1;for(var r=0;r<o.length;r++)(a=o[r]).width>=e&&a.height>=i&&(n=this._contactPointScoreNode(a.x,a.y,e,i))>h.value&&(s.x=a.x,s.y=a.y,s.width=e,s.height=i,h=n),this.allowRotate&&a.width>=i&&a.height>=e&&(n=this._contactPointScoreNode(a.x,a.y,i,e))>h.value&&(s.x=a.x,s.y=a.y,s.width=i,s.height=e,h.value=n);return s},_splitFreeNode:function(t,e){var i,h=this.freeRectangles;return!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)&&(e.x<t.x+t.width&&e.x+e.width>t.x&&(e.y>t.y&&e.y<t.y+t.height&&((i=t.clone()).height=e.y-i.y,h.push(i)),e.y+e.height<t.y+t.height&&((i=t.clone()).y=e.y+e.height,i.height=t.y+t.height-(e.y+e.height),h.push(i))),e.y<t.y+t.height&&e.y+e.height>t.y&&(e.x>t.x&&e.x<t.x+t.width&&((i=t.clone()).width=e.x-i.x,h.push(i)),e.x+e.width<t.x+t.width&&((i=t.clone()).x=e.x+e.width,i.width=t.x+t.width-(e.x+e.width),h.push(i))),!0)},_pruneFreeList:function(){for(var e=this.freeRectangles,i=0;i<e.length;i++)for(var h=i+1;h<e.length;h++){if(t.isContainedIn(e[i],e[h])){e.splice(i,1);break}t.isContainedIn(e[h],e[i])&&e.splice(h,1)}}},e.heuristices={BestShortSideFit:0,BestLongSideFit:1,BestAreaFit:2,BottomLeftRule:3,ContactPointRule:4},module.exports=e;