"use strict";const e=Editor.require("scene://edit-mode"),n=Editor.require("scene://utils/animation"),t=Editor.require("scene://utils/scene"),r=Editor.require("scene://dump/hierarchy");module.exports={"query-dirty-state"(n){if(n.reply){let t=e.dirtyMode();if(t)return n.reply(null,{dirty:!0,name:t.name}),void 0;n.reply(null,{name:"scene",dirty:_Scene.Undo.dirty()})}},"query-group-list"(e){e.reply&&e.reply(null,cc.game.groupList)},"query-hierarchy"(e){if(!cc.engine.isInitialized)return e.reply(null,"",[]),void 0;let n=r.node(),t=_Scene.currentScene().uuid;e.reply(null,t,n)},"query-nodes-by-comp-name"(e,n){let t=cc.director.getScene(),r=[],i=cc.js.getClassByName(n);i&&_Scene.walk(t,!1,e=>{e.getComponent(i)&&r.push(e.uuid)}),e.reply(null,r)},"query-node"(e,n,t){if(e.reply){let t=_Scene.dumpNode(n);return t=JSON.stringify(t),e.reply(null,t),void 0}let r=_Scene.dumpNode(t);r=JSON.stringify(r),Editor.Ipc.sendToWins("scene:reply-query-node",n,r)},"query-node-info"(e,n,t){let r=null,i=cc.engine.getInstanceById(n);i&&(r=i instanceof cc.Component?i.node:i);let l=null;r&&"cc.Node"!==t&&(l=r.getComponent(cc.js._getClassById(t))),e.reply(null,{name:r?r.name:"",missed:null===i,nodeID:r?r.uuid:null,compID:l?l.uuid:null})},"query-node-functions"(e,n){var t=cc.engine.getInstanceById(n),r=Editor.getNodeFunctions(t);e.reply(null,r)},"choose-last-rigid-body"(e,n){var t=cc.engine.getInstanceById(n);if(t instanceof cc.Joint){var r=t.node.getSiblingIndex()-1;r<0&&(r=t.node.parent.children.length-1);var i=t.node.parent.children[r];if(!i)return;_Scene.Undo.recordNode(t.node.uuid),t.connectedBody=i.getComponent(cc.RigidBody),_Scene.Undo.commit()}},"choose-next-rigid-body"(e,n){var t=cc.engine.getInstanceById(n);if(t instanceof cc.Joint){var r=t.node.getSiblingIndex()+1;r>=t.node.parent.children.length&&(r=0);var i=t.node.parent.children[r];i||(i=t.node.parent),_Scene.Undo.recordNode(t.node.uuid),t.connectedBody=i.getComponent(cc.RigidBody),_Scene.Undo.commit()}},"is-child-class-of"(e,n,t){let r=cc.js._getClassById(n),i=cc.js._getClassById(t),l=cc.js.isChildClassOf(r,i);e.reply(null,l)},"has-copied-component":function(e){e.reply&&e.reply(null,t.hasCopiedComponent())},"query-animation-hierarchy"(e,n){let t=cc.engine.getInstanceById(n),i=t;for(;i&&!i.getComponent(cc.Animation);){if(i.parent instanceof cc.Scene){i=t;break}i=i.parent}e.reply&&e.reply(null,JSON.stringify(r.node(i,!0)))},"query-animation-list"(e,n){let t=cc.engine.getInstanceById(n);if(!t||t instanceof cc.Scene)return e.reply&&e.reply(null,[]),void 0;let r=t.getComponent(cc.Animation);if(!r)return e.reply&&e.reply(null,[]),void 0;let i=r.getClips(),l=(i=i.filter(function(e){return!!e})).map(e=>e._uuid);e.reply&&e.reply(null,l)},"query-animation-properties"(e,t){let r=cc.engine.getInstanceById(t),i=r;for(;i&&!i.getComponent(cc.Animation);){if(i.parent instanceof cc.Scene){i=r;break}i=i.parent}let l=Editor.getNodeDump(r),c=n.queryEditProperties(l,i!==r);e.reply&&e.reply(null,c)},"query-animation-record"(t){let r=e.curMode(),i=n.Cache.rNode,l=cc.engine.getInstanceById(n.Cache.component),c=l&&l.getAnimationState(n.Cache.animation).clip,o={record:r&&"animation"===r.name,root:i,clip:c?{id:c._uuid,name:c.name}:null};t.reply&&t.reply(null,o)},"query-animation-clip"(e,t){if(!n.curAnim)return e.reply&&e.reply(null,null);let r=n.curAnim.getClips();for(let n=0;n<r.length;n++){let i=r[n];if(i._uuid===t)return e.reply&&e.reply(null,Editor.serialize(i))}e.reply&&e.reply(null,null)},"query-asset-info"(e,n){e.reply&&Editor.assetdb.queryInfoByUuid(n,(...n)=>{e.reply(...n)})}};