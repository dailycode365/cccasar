"use strict";const r=require("graceful-fs"),t=require("path"),o=require("assert"),n="win32"===process.platform;function e(t){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(o=>{t[o]=t[o]||r[o],t[o+="Sync"]=t[o]||r[o]}),t.maxBusyTries=t.maxBusyTries||3}function i(r,t,i){let f=0;"function"==typeof t&&(i=t,t={}),o(r,"rimraf: missing path"),o.equal(typeof r,"string","rimraf: path should be a string"),o.equal(typeof i,"function","rimraf: callback function required"),o(t,"rimraf: invalid options argument provided"),o.equal(typeof t,"object","rimraf: options should be object"),e(t),c(r,t,function o(e){if(e){if(n&&("EBUSY"===e.code||"ENOTEMPTY"===e.code||"EPERM"===e.code)&&f<t.maxBusyTries){return f++,setTimeout(()=>c(r,t,o),100*f)}"ENOENT"===e.code&&(e=null)}i(e)})}function c(r,t,e){o(r),o(t),o("function"==typeof e),t.lstat(r,(o,i)=>o&&"ENOENT"===o.code?e(null):o&&"EPERM"===o.code&&n?f(r,t,o,e):i&&i.isDirectory()?E(r,t,o,e):(t.unlink(r,o=>{if(o){if("ENOENT"===o.code)return e(null);if("EPERM"===o.code)return n?f(r,t,o,e):E(r,t,o,e);if("EISDIR"===o.code)return E(r,t,o,e)}return e(o)}),void 0))}function f(r,t,n,e){o(r),o(t),o("function"==typeof e),n&&o(n instanceof Error),t.chmod(r,666,o=>{o?e("ENOENT"===o.code?null:n):t.stat(r,(o,i)=>{o?e("ENOENT"===o.code?null:n):i.isDirectory()?E(r,t,n,e):t.unlink(r,e)})})}function u(r,t,n){let e;o(r),o(t),n&&o(n instanceof Error);try{t.chmodSync(r,666)}catch(r){if("ENOENT"===r.code)return;throw n}try{e=t.statSync(r)}catch(r){if("ENOENT"===r.code)return;throw n}e.isDirectory()?a(r,t,n):t.unlinkSync(r)}function E(r,n,e,c){o(r),o(n),e&&o(e instanceof Error),o("function"==typeof c),n.rmdir(r,f=>{!f||"ENOTEMPTY"!==f.code&&"EEXIST"!==f.code&&"EPERM"!==f.code?f&&"ENOTDIR"===f.code?c(e):c(f):function(r,n,e){o(r),o(n),o("function"==typeof e),n.readdir(r,(o,c)=>{if(o)return e(o);let f,u=c.length;if(0===u)return n.rmdir(r,e);c.forEach(o=>{i(t.join(r,o),n,t=>{if(!f)return t?e(f=t):(0==--u&&n.rmdir(r,e),void 0)})})})}(r,n,c)})}function d(r,t){let i;e(t=t||{}),o(r,"rimraf: missing path"),o.equal(typeof r,"string","rimraf: path should be a string"),o(t,"rimraf: missing options"),o.equal(typeof t,"object","rimraf: options should be object");try{i=t.lstatSync(r)}catch(o){if("ENOENT"===o.code)return;"EPERM"===o.code&&n&&u(r,t,o)}try{i&&i.isDirectory()?a(r,t,null):t.unlinkSync(r)}catch(o){if("ENOENT"===o.code)return;if("EPERM"===o.code)return n?u(r,t,o):a(r,t,o);if("EISDIR"!==o.code)throw o;a(r,t,o)}}function a(r,n,e){o(r),o(n),e&&o(e instanceof Error);try{n.rmdirSync(r)}catch(i){if("ENOENT"===i.code)return;if("ENOTDIR"===i.code)throw e;"ENOTEMPTY"!==i.code&&"EEXIST"!==i.code&&"EPERM"!==i.code||function(r,n){o(r),o(n),n.readdirSync(r).forEach(o=>d(t.join(r,o),n)),n.rmdirSync(r,n)}(r,n)}}module.exports=i,i.sync=d;