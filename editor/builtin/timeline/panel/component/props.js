"use strict";const e=require("fire-fs"),t=require("path"),p=require("../libs/manager"),r=require("../libs/advice");exports.template=e.readFileSync(t.join(__dirname,"../template/props.html"),"utf-8"),exports.props=["props","node","clip","selected"],exports.watch={node(e){try{this.updateProps(e,this.clip)}catch(e){Editor.error(e)}},clip(e){try{this.updateProps(this.node,e)}catch(e){Editor.error(e)}}},exports.data=function(){return{}},exports.methods={t:Editor.T,updateProps(e,t){if(!e||!t)return;let r=p.Clip.queryCurve(t.id,e.path);for(;this.props.length;)this.props.pop();r&&(Object.keys(r.props).forEach(e=>{this.props.push({component:null,property:e})}),Object.keys(r.comps).forEach(e=>{Object.keys(r.comps[e]).forEach(t=>{this.props.push({component:e,property:t})})}))},_onScroll(e){let t=e.target;r.emit("property-scroll",t.scrollTop)},_onAddPropertyClick(e){Editor.Ipc.sendToMain("timeline:menu-add-property",{x:e.pageX,y:e.pageY,nodeId:this.node.id})},_onPropertyClick(e,t,p){let r=this.selected.some(e=>e.component===t&&e.property===p);Editor.Ipc.sendToMain("timeline:menu-property-operation",{uuid:this.clip.id,path:this.node.path,component:t,property:p,type:this.clip.type,selected:r,x:e.pageX,y:e.pageY})}},exports.created=function(){r.on("property-scroll",e=>{this.$el.scrollTop=e}),r.on("clip-data-update",()=>{this.updateProps(this.node,this.clip)})};