"use strict";window.Cache=module.exports;const e=require("./event");let r={},n={id:"root",children:[],show:!0},t=[],o=[],s=[];exports.lineHeight=19,exports.queryCache=function(){return r},exports.queryRoot=function(){return n},exports.queryRoots=function(){return t},exports.queryNodes=function(){return o},exports.queryShowNodes=function(){return s},exports.updateShowNodes=function(e){s.length=[],e.forEach(e=>{s.push(e)})},exports.queryNode=function(e){let n=r[e];return n||null},exports.genAssetsTree=function(e){e.forEach(e=>{r[e.uuid]=d(e)}),n.children.length=0;for(let e in r){let t=r[e];t.hidden||(t.parent?(t.level=r[t.parent].level+1,r[t.parent].children.push(t),o.push(t)):(n.children.push(t),t.level=0))}let t=function(e){e&&(e.sort(exports.sortChildrenNodes),e.forEach(e=>{t(e.children)}))};return t(n.children),n},exports.sortChildrenNodes=((e,r)=>{let n="folder"===e.assetType,t="folder"===r.assetType;return n||t?n&&t?e.name<r.name?-1:1:n?-1:1:e.name<r.name?-1:1});let d=function(e){return{id:e.uuid,name:e.name,extname:e.extname,assetType:e.type,isSubAsset:e.isSubAsset,readonly:e.readonly,hidden:e.hidden,parent:e.parentUuid||null,children:[],selected:!1,fold:!0,show:!e.parentUuid,rename:!1,level:0,hint:!1,iconUrl:null}};exports.add=function(n){n=d(n),r[n.id]=n;let t=r[n.parent];n.level=t.level+1,n.parent&&t.children.push(n),t.children.sort(exports.sortChildrenNodes),o.push(n),e.emit("node-added",n)},exports.remove=function(n){let t=this.queryNode(n),s=r[t.parent];return!!s&&(s.children.forEach((e,r)=>{if(e===t)return s.children.splice(r,1),void 0}),delete r[n],o.forEach((e,r)=>{if(e===t)return o.splice(r,1),void 0}),e.emit("node-removed",t),!0)};