"use strict";const e=require("./utils/cache"),i=require("./utils/operation");let t=e.queryCache(),n=[],r=function(r){let d={};function o(r,c,l){d[r.id]={node:r,parent:l},t[r.id]&&function(r,d,o){let c=t[r.id],l=t[d];if(d!==c.parent)return e.remove(r.id),void 0;if(l&&l.children[o]!==r.id){e.remove(r.id);let i=n.indexOf(r.id);return-1!==i&&n.splice(i,1),void 0}if(null===d&&n[o]!==r.id){e.remove(r.id);let i=n.indexOf(r.id);return-1!==i&&n.splice(i,1),void 0}let u=e.queryNode(r.id);u.name!==r.name&&(u.name=r.name,i.hint(r.id)),u.prefabState!==r.prefabState&&(u.prefabState=r.prefabState,i.hint(r.id)),u.locked!==r.locked&&(u.locked=r.locked)}(r,l,c),t[r.id]||(e.add(r,l||null,c),null===l&&n.splice(c,0,r.id)),r.children&&r.children.forEach((e,i)=>{o(e,i,r.id)})}r.forEach((e,i)=>{o(e,i,null)}),Object.keys(t).forEach(i=>{if(!d[i]){e.remove(i);let t=n.indexOf(i);-1!==t&&n.splice(t,1)}})},d=null,o=function(){Editor.Ipc.sendToPanel("scene","scene:query-hierarchy",(e,i,t)=>{r(t),d=setTimeout(()=>{o()},300)},-1)};exports.startup=function(){o()},exports.stop=function(){clearTimeout(d),r([])},exports.reset=function(){};