"use strict";const n=require("fire-path"),i=require("fire-fs"),e=require("../../share/build-platforms"),t='<script src="https://analytics.cocos.com/assets/js/cocosAnalytics.min.js" charset="utf-8"><\/script>';function s(s,r){let o=Editor._projectProfile.data["cocos-analytics"];o.enable&&(e[s.platform].isNative||function(e,s){let r=n.join(e.dest,"index.html");if(!i.existsSync(r))return Editor.warn("[Cocos Analystic] Can not find index.html"),void 0;let o=i.readFileSync(r,"utf8").split("\n");for(let n=0;n<o.length;n++)if(o[n].match(/src *= *["|']main.js["|']/)){o.splice(n,0,t);break}i.writeFileSync(r,o.join("\n"))}(s),function(e,t){let s=n.join(e.dest,"main.js");if(!i.existsSync(s))return Editor.warn("[Cocos Analystic] Can not find main.js"),void 0;let r=`\n    // Begin Cocos Analytics\n    (function () {\n        if ((typeof cocosAnalytics) !== 'undefined'){\n            var initArgs = {\n                appID: '${t.appID}',\n                appSecret: '${t.appSecret}',\n                channel: '${void 0===t.channel?"":t.channel}',\n                version: '${void 0===t.version?"":t.version}'\n            };\n\n            if (!initArgs.appID || !initArgs.appSecret || !initArgs.version) {\n                console.error('请在编辑器设置好 Cocos Analytics 的 appID, appSecret 和 version');\n                return;\n            }\n\n            cocosAnalytics.init(initArgs);\n        }\n    })();\n    // End Cocos Analytics\n    `,o=i.readFileSync(s,"utf8");o+=r,i.writeFileSync(s,o)}(s,o)),r()}module.exports={load(){Editor.Builder.on("before-change-files",s)},unload(){Editor.Builder.removeListener("before-change-files",s)},messages:{}};